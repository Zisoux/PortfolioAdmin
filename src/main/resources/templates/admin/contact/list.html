<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Admin | ë¬¸ì˜ ê´€ë¦¬</title>

    <!-- í°íŠ¸ (í™ˆì´ë‘ ë™ì¼) -->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap"
            rel="stylesheet"
    />

    <!-- Bootstrap (í…Œì´ë¸”, ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ìš©) -->
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />

    <style>
        body {
            margin: 0;
            font-family: "IBM Plex Sans", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background-color: #f3f4f6;
            color: #111827;
        }

        .pf-shell {
            max-width: 1120px;
            margin: 0 auto;
            padding: 32px 24px 64px;
        }

        /* ìƒë‹¨ ê´€ë¦¬ì í—¤ë” */
        .pf-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            margin-bottom: 24px;
            color: #6b7280;
        }

        .pf-top-left {
            font-weight: 600;
            color: #111827;
        }

        .pf-top-left a {
            text-decoration: none;
            color: inherit;
        }

        .pf-top-left span.badge-admin {
            font-size: 11px;
            margin-left: 8px;
            padding: 2px 8px;
            border-radius: 999px;
            background-color: #dcfce7;
            color: #15803d;
        }

        .pf-top-links {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .pf-top-links a {
            text-decoration: none;
            color: #6b7280;
        }

        .pf-top-links a:hover {
            color: #111827;
        }

        .pf-top-links a.active {
            color: #16a34a;
            font-weight: 600;
        }

        .btn-link-like {
            border: none;
            background: none;
            padding: 0;
            font-size: 12px;
            color: #6b7280;
        }

        .btn-link-like:hover {
            text-decoration: underline;
            color: #111827;
        }

        /* í˜ì´ì§€ íƒ€ì´í‹€ ì˜ì—­ */
        .section-title-label {
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: #16a34a;
            margin-bottom: 6px;
        }

        .admin-title {
            font-size: 28px;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 6px;
        }

        .admin-sub {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 20px;
        }

        /* í•„í„° ë²„íŠ¼ ë°•ìŠ¤ */
        .admin-toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .badge-new-count {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 999px;
            background-color: #dcfce7;
            color: #15803d;
        }

        .admin-filter-buttons .btn {
            font-size: 12px;
            border-radius: 999px;
            padding: 5px 12px;
        }

        /* í…Œì´ë¸” ì¹´ë“œ */
        .admin-card {
            border-radius: 16px;
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
            box-shadow: 0 16px 40px rgba(15, 23, 42, 0.06);
            padding: 16px 18px 6px;
        }

        .admin-table {
            margin-bottom: 4px;
            font-size: 13px;
        }

        .admin-table thead tr {
            background-color: #f9fafb;
        }

        .admin-table thead th {
            border-bottom-width: 1px;
            border-color: #e5e7eb;
            color: #6b7280;
            font-weight: 500;
        }

        .admin-table tbody td {
            vertical-align: middle;
            border-color: #f3f4f6;
        }

        .badge-status-new {
            background-color: #16a34a;
        }

        .badge-status-read {
            background-color: #9ca3af;
        }

        .btn-mark-read {
            font-size: 11px;
            border-radius: 999px;
            padding: 4px 10px;
        }

        /* ê¸´ ë©”ì‹œì§€ëŠ” í•œ ì¤„ë¡œ ì¤„ì´ê¸° */
        .cell-message {
            max-width: 340px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (max-width: 768px) {
            .pf-shell {
                padding: 20px 16px 40px;
            }
            .cell-message {
                max-width: 200px;
            }
        }
    </style>
</head>
<body>

<div th:replace="~{fragments/header :: header('contacts')}"></div>

<div class="pf-shell">

    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="pf-top-bar">
        <div class="pf-top-left">
            <a th:href="@{/}">í™ì§€ìˆ˜ Portfolio</a>
            <span class="badge-admin">ADMIN</span>
        </div>
    </div>

    <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
    <section style="margin-bottom: 12px;">
        <div class="section-title-label">ADMIN PAGE</div>
        <h1 class="admin-title">ë¬¸ì˜í•¨</h1>
        <p class="admin-sub">
            í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì´íŠ¸ì—ì„œ ë“¤ì–´ì˜¨ ë¬¸ì˜ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ê³  ì½ìŒ ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </p>
    </section>

    <!-- íˆ´ë°” + ë±ƒì§€ -->
    <div class="admin-toolbar">
        <div>
            <span class="badge-new-count">
                <span th:text="${unreadCount}">0</span> new
            </span>
        </div>
        <div class="admin-filter-buttons">
            <a th:href="@{/admin/contacts}" class="btn btn-outline-secondary btn-sm">ì „ì²´ ë³´ê¸°</a>
            <a th:href="@{/admin/contacts(unreadOnly=true)}" class="btn btn-outline-success btn-sm">ì½ì§€ ì•Šì€ ê²ƒë§Œ</a>
        </div>
    </div>

    <!-- í…Œì´ë¸” ì¹´ë“œ -->
    <div class="admin-card">
        <table class="table table-sm align-middle admin-table">
            <thead>
            <tr>
                <th style="width: 40px;">#</th>
                <th style="width: 120px;">ì´ë¦„</th>
                <th style="width: 200px;">Email</th>
                <th>ë©”ì‹œì§€</th>
                <th style="width: 150px;">ë°›ì€ ì‹œê°</th>
                <th style="width: 80px;">ìƒíƒœ</th>
                <th style="width: 110px;"></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="c, stat : ${contacts}">
                <td th:text="${stat.count}">1</td>
                <td th:text="${c.name}">í™ì§€ìˆ˜</td>
                <td th:text="${c.email}">test@example.com</td>

                <!-- ğŸ”¹ ë©”ì‹œì§€: ì§§ê²Œ ë³´ì—¬ì£¼ê³  í´ë¦­í•˜ë©´ ëª¨ë‹¬ -->
                <td>
                    <a href="#"
                       class="text-decoration-none"
                       data-bs-toggle="modal"
                       data-bs-target="#contactMessageModal"
                       th:data-name="${c.name}"
                       th:data-email="${c.email}"
                       th:data-created="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}"
                       th:data-message="${c.message}">
                        <span th:text="${#strings.abbreviate(c.message, 40)}">ë‚´ìš©</span>
                        <span th:if="${#strings.length(c.message) > 40}" class="text-muted">...</span>
                    </a>
                </td>

                <td th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">2025-01-01</td>
                <td>
                    <span th:if="${!c.readFlag}" class="badge bg-success">NEW</span>
                    <span th:if="${c.readFlag}" class="badge bg-secondary">ì½ìŒ</span>
                </td>
                <td>
                    <form th:if="${!c.readFlag}"
                          th:action="@{/admin/contacts/{id}/read(id=${c.id})}"
                          method="post">
                        <button class="btn btn-outline-dark btn-sm" type="submit">ì½ìŒ ì²˜ë¦¬</button>
                    </form>
                </td>
            </tr>
            </tbody>

        </table>
    </div>

</div>
<!-- ğŸ”¹ ë¬¸ì˜ ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ -->
<div class="modal fade" id="contactMessageModal" tabindex="-1"
     aria-labelledby="contactMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="contactMessageModalLabel">ë¬¸ì˜ ìƒì„¸</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <dl class="row mb-2">
                    <dt class="col-sm-2">ì´ë¦„</dt>
                    <dd class="col-sm-10" id="modalContactName">-</dd>

                    <dt class="col-sm-2">Email</dt>
                    <dd class="col-sm-10" id="modalContactEmail">-</dd>

                    <dt class="col-sm-2">ë°›ì€ ì‹œê°</dt>
                    <dd class="col-sm-10" id="modalContactCreatedAt">-</dd>
                </dl>

                <hr/>

                <h6 class="mb-2">ë©”ì‹œì§€</h6>
                <pre id="modalContactMessage"
                     style="white-space: pre-wrap; font-family: inherit;"></pre>
            </div>
            <div class="modal-footer">
                <button type="button"
                        class="btn btn-secondary btn-sm"
                        data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const msgModal = document.getElementById('contactMessageModal');

    if (msgModal) {
        msgModal.addEventListener('show.bs.modal', function (event) {
            const trigger = event.relatedTarget; // í´ë¦­í•œ a íƒœê·¸

            if (!trigger) return;

            const name = trigger.getAttribute('data-name') || '';
            const email = trigger.getAttribute('data-email') || '';
            const created = trigger.getAttribute('data-created') || '';
            const message = trigger.getAttribute('data-message') || '';

            msgModal.querySelector('#modalContactName').textContent = name;
            msgModal.querySelector('#modalContactEmail').textContent = email;
            msgModal.querySelector('#modalContactCreatedAt').textContent = created;
            msgModal.querySelector('#modalContactMessage').textContent = message;
        });
    }
</script>

<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
</script>
</body>
</html>
